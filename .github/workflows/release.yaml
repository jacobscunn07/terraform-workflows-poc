name: Release

concurrency: terraform-lock

on:
  push:
    branches:
      - main

  workflow_dispatch:

permissions:
  contents: read
  pull-requests: write

jobs:
  hello:
    runs-on: ubuntu-latest
    steps:
      - name: Hello world action step
        id: hello
        uses: ./.github/actions/hello-world
        with:
          who-to-greet: 'Jacob'
      - name: Get the output time
        run: echo "The time was ${{ steps.hello.outputs.time }}"

  staging:
    uses: ./.github/workflows/_tf-apply.yaml
    with:
      environment: staging
      workspace: staging

  production:
    needs: staging
    uses: ./.github/workflows/_tf-apply.yaml
    with:
      environment: production
      workspace: production
